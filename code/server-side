
# BACKEND: important files

## backend/package.json

//json
{
  "name": "online-quiz-backend",
  "version": "1.0.0",
  "main": "server.js",
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js"
  },
  "dependencies": {
    "bcrypt": "^5.1.0",
    "cors": "^2.8.5",
    "dotenv": "^16.0.0",
    "express": "^4.18.2",
    "jsonwebtoken": "^9.0.0",
    "mongoose": "^7.0.0"
  },
  "devDependencies": {
    "nodemon": "^2.0.22"
  }
}
//

## backend/.env.example

//
PORT=5000
MONGO_URI=mongodb://localhost:27017/online-quiz
JWT_SECRET=your_jwt_secret_here
//

## backend/config/db.js

//js
const mongoose = require('mongoose')

module.exports = async function connectDB(uri){
  await mongoose.connect(uri)
  console.log('MongoDB connected')
}
//

## backend/models/User.js

//js
const mongoose = require('mongoose')
const Schema = mongoose.Schema

const UserSchema = new Schema({
  email: { type: String, required: true, unique: true },
  password: { type: String, required: true },
  role: { type: String, enum: ['student','admin'], default: 'student'},
  name: { type: String },
  createdAt: { type: Date, default: Date.now }
})

module.exports = mongoose.model('User', UserSchema)
//

## backend/models/Quiz.js

//js
const mongoose = require('mongoose')
const Schema = mongoose.Schema

const QuestionSchema = new Schema({
  text: String,
  choices: [String],
  correctIndex: Number
})

const QuizSchema = new Schema({
  title: String,
  description: String,
  questions: [QuestionSchema],
  createdAt: { type: Date, default: Date.now }
})

module.exports = mongoose.model('Quiz', QuizSchema)
//

## backend/middleware/authMiddleware.js

//js
const jwt = require('jsonwebtoken')
const User = require('../models/User')

module.exports = async function(req,res,next){
  const header = req.headers.authorization
  if(!header) return res.status(401).json({ message: 'No token' })
  const token = header.split(' ')[1]
  try{
    const payload = jwt.verify(token, process.env.JWT_SECRET)
    req.user = await User.findById(payload.id).select('-password')
    next()
  }catch(err){
    res.status(401).json({ message: 'Invalid token' })
  }
}
//

## backend/controllers/authController.js

//js
const bcrypt = require('bcrypt')
const jwt = require('jsonwebtoken')
const User = require('../models/User')

exports.register = async (req,res)=>{
  const { email, password } = req.body
  if(!email||!password) return res.status(400).json({ message: 'Missing' })
  const exists = await User.findOne({ email })
  if(exists) return res.status(400).json({ message: 'User already exists' })
  const hashed = await bcrypt.hash(password, 10)
  const user = await User.create({ email, password: hashed })
  res.json({ message: 'OK' })
}

exports.login = async (req,res)=>{
  const { email, password } = req.body
  const user = await User.findOne({ email })
  if(!user) return res.status(400).json({ message: 'Invalid credentials' })
  const ok = await bcrypt.compare(password, user.password)
  if(!ok) return res.status(400).json({ message: 'Invalid credentials' })
  const token = jwt.sign({ id: user._id }, process.env.JWT_SECRET, { expiresIn: '7d' })
  res.json({ token, user: { id: user._id, email: user.email, role: user.role } })
}
//

## backend/controllers/quizController.js

//js
const Quiz = require('../models/Quiz')

exports.list = async (req,res)=>{
  const quizzes = await Quiz.find().select('-questions.correctIndex')
  res.json(quizzes)
}

exports.get = async (req,res)=>{
  const q = await Quiz.findById(req.params.id)
  if(!q) return res.status(404).json({ message: 'Not found' })
  res.json(q)
}

exports.submit = async (req,res)=>{
  const quiz = await Quiz.findById(req.params.id)
  if(!quiz) return res.status(404).json({ message: 'Not found' })
  const answers = req.body.answers || {}
  let score = 0
  quiz.questions.forEach((ques, idx)=>{
    const selected = answers[idx]
    if(typeof selected !== 'undefined' && selected === ques.correctIndex) score++
  })
  res.json({ score, total: quiz.questions.length })
}
//

## backend/routes/auth.js

//js
const express = require('express')
const router = express.Router()
const { register, login } = require('../controllers/authController')

router.post('/register', register)
router.post('/login', login)

module.exports = router
//

## backend/routes/quizzes.js

//js
const express = require('express')
const router = express.Router()
const { list, get, submit } = require('../controllers/quizController')
const auth = require('../middleware/authMiddleware')

router.get('/', list)
router.get('/:id', get)
router.post('/:id/submit', auth, submit)

module.exports = router
//

## backend/server.js

//js
require('dotenv').config()
const express = require('express')
const cors = require('cors')
const connectDB = require('./config/db')

const app = express()
app.use(cors())
app.use(express.json())

connectDB(process.env.MONGO_URI || 'mongodb://localhost:27017/online-quiz')

app.use('/api/auth', require('./routes/auth'))
app.use('/api/quizzes', require('./routes/quizzes'))

const PORT = process.env.PORT || 5000
app.listen(PORT, ()=> console.log('Server listening on', PORT))
//
